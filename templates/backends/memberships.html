{% extends 'base/base.html' %}
{% load static %}

{% block title %}Ethereal - Memberships{% endblock %}

{% block content %}
<section class="pt-28 pb-24">
	<div class="flex flex-col lg:flex-row min-h-[calc(100vh-7rem)]">
		{% include 'backends/partials/sidebar.html' with sidebar_title='Memberships' %}

		<div class="flex-1 px-6 lg:px-12 xl:px-16 py-10">
			<div class="max-w-7xl">
				<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-8 mb-16">
					<div>
						<p class="text-xs tracking-[0.4em] uppercase text-twilight dark:text-lavender-mist mb-3">Backends</p>
						<h2 class="font-cormorant text-4xl lg:text-5xl text-obsidian dark:text-pearl font-light">Memberships</h2>
					</div>
					<a href="{% url 'backends:add_membership' %}"
						class="btn px-8 py-3 text-xs tracking-[0.25em] uppercase bg-obsidian text-moon-white dark:bg-pearl dark:text-obsidian hover:bg-rose-gold transition-colors rounded-lg font-semibold">+ Add Membership</a>
				</div>

					{% if memberships %}
					<!-- Tier Groups Section -->
					{% regroup memberships by tier as membership_by_tier %}
					
					<div class="space-y-20">
						{% for tier_group in membership_by_tier %}
							<div>
								<!-- Tier Header -->
								<div class="mb-12 flex items-center gap-4 pb-6 border-b-2 border-obsidian/10 dark:border-pearl/10">
									{% if tier_group.grouper == 'bronze' %}
										<div class="w-3 h-20 bg-gradient-to-b from-amber-600 to-amber-800 rounded-full"></div>
										<div>
											<h3 class="font-cormorant text-4xl text-amber-900 dark:text-amber-200 font-light">Bronze Tier</h3>
											<p class="text-xs text-amber-700 dark:text-amber-300 tracking-wider">Entry-level luxury membership</p>
										</div>
									{% elif tier_group.grouper == 'silver' %}
										<div class="w-3 h-20 bg-gradient-to-b from-slate-400 to-slate-600 rounded-full"></div>
										<div>
											<h3 class="font-cormorant text-4xl text-slate-900 dark:text-slate-100 font-light">Silver Tier</h3>
											<p class="text-xs text-slate-700 dark:text-slate-300 tracking-wider">Premium membership benefits</p>
										</div>
									{% elif tier_group.grouper == 'gold' %}
										<div class="w-3 h-20 bg-gradient-to-b from-yellow-500 to-yellow-700 rounded-full"></div>
										<div>
											<h3 class="font-cormorant text-4xl text-yellow-900 dark:text-yellow-200 font-light">Gold Tier</h3>
											<p class="text-xs text-yellow-700 dark:text-yellow-300 tracking-wider">Exclusive benefits & privileges</p>
										</div>
									{% elif tier_group.grouper == 'platinum' %}
										<div class="w-3 h-20 bg-gradient-to-b from-blue-400 to-blue-600 rounded-full"></div>
										<div>
											<h3 class="font-cormorant text-4xl text-blue-900 dark:text-blue-200 font-light">Platinum Tier</h3>
											<p class="text-xs text-blue-700 dark:text-blue-300 tracking-wider">Luxury VIP membership</p>
										</div>
									{% endif %}
								</div>

								<!-- Tier Cards Grid -->
								<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
									{% for membership in tier_group.list %}
										{% if membership.is_featured %}
											<!-- Featured Card - Spans 2 columns -->
											<div class="lg:col-span-2 md:col-span-2">
												<div class="relative rounded-3xl border-2 border-rose-gold/50 overflow-hidden bg-gradient-to-br from-rose-gold/10 via-transparent to-obsidian/5 dark:to-pearl/5 p-10 shadow-[0_30px_70px_rgba(201,167,151,0.15)] card-glow group hover:border-rose-gold/80 hover:shadow-[0_40px_80px_rgba(201,167,151,0.25)] transition-all duration-300">
													<!-- Featured Badge Corner -->
													<div class="absolute -top-3 -right-3 bg-gradient-to-br from-rose-gold to-amber-600 text-obsidian px-5 py-1.5 rounded-lg font-cormorant text-sm font-light shadow-lg">Featured</div>
													
													<div class="grid md:grid-cols-2 gap-10 items-center">
														<!-- Left: Main Info -->
														<div class="space-y-6">
															<div>
																<p class="text-xs tracking-[0.3em] uppercase text-rose-gold font-bold mb-2">Premium Choice</p>
																<h3 class="font-cormorant text-5xl text-obsidian dark:text-pearl font-light leading-tight">{{ membership.name }}</h3>
															</div>
															<p class="text-sm text-twilight dark:text-lavender-mist leading-relaxed">{{ membership.description }}</p>
															
															<div>
																<div class="text-6xl font-cormorant text-rose-gold font-light leading-tight">${{ membership.price }}</div>
																<p class="text-xs text-twilight dark:text-lavender-mist mt-2">/month recurring billing</p>
															</div>

															{% if membership.discount_percentage %}
																<div class="inline-block px-5 py-3 bg-rose-gold/15 border border-rose-gold/30 rounded-xl">
																	<p class="text-xs text-twilight dark:text-lavender-mist mb-1">Member Discount</p>
																	<p class="text-3xl font-cormorant text-rose-gold font-light">{{ membership.discount_percentage }}%</p>
																</div>
															{% endif %}
															
															<a href="{% url 'backends:add_membership' %}?id={{ membership.id }}"
																class="btn inline-block px-8 py-3 bg-rose-gold text-obsidian font-cormorant font-light text-base tracking-[0.15em] rounded-lg hover:bg-rose-gold/90 shadow-[0_20px_40px_rgba(201,167,151,0.2)] hover:shadow-[0_30px_60px_rgba(201,167,151,0.3)] transition-all">Edit Plan</a>
														</div>

														<!-- Right: Benefits Showcase -->
														<div class="space-y-6">
															<div>
																<p class="text-xs tracking-[0.3em] uppercase text-obsidian/60 dark:text-pearl/60 font-semibold mb-4">What's Included</p>
																<div class="space-y-4">
																	{% for benefit in membership.benefits|slice:":6" %}
																		<div class="flex items-start gap-3 pb-4 border-b border-obsidian/10 dark:border-pearl/10">
																			<svg class="w-5 h-5 text-rose-gold mt-1 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
																				<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
																			</svg>
																			<span class="text-sm text-obsidian dark:text-pearl font-light">{{ benefit }}</span>
																		</div>
																	{% endfor %}
																</div>
															</div>

															<div class="pt-4 border-t border-obsidian/10 dark:border-pearl/10">
																<div class="flex gap-8 text-center">
																	<div>
																		<p class="text-xs text-twilight dark:text-lavender-mist uppercase tracking-[0.2em] font-semibold mb-1">Status</p>
																		<p class="text-lg font-cormorant text-obsidian dark:text-pearl font-light">
																			{% if membership.is_active %}Active{% else %}Inactive{% endif %}
																		</p>
																	</div>
																	<div class="border-l border-obsidian/20 dark:border-pearl/20"></div>
																	<div>
																		<p class="text-xs text-twilight dark:text-lavender-mist uppercase tracking-[0.2em] font-semibold mb-1">Added</p>
																		<p class="text-sm font-cormorant text-obsidian dark:text-pearl font-light">{{ membership.created_at|date:"M d" }}</p>
																	</div>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										{% else %}
											<!-- Standard Card -->
											<div class="group rounded-2xl border border-obsidian/15 dark:border-pearl/15 bg-moon-white/85 dark:bg-black-pearl/70 p-8 shadow-[0_20px_40px_rgba(27,26,23,0.08)] hover:shadow-[0_30px_60px_rgba(27,26,23,0.15)] hover:border-obsidian/30 dark:hover:border-pearl/30 transition-all duration-300 flex flex-col">
												<div class="mb-6 flex-1">
													<div class="flex items-start justify-between gap-3 mb-4">
														<div>
															<h3 class="font-cormorant text-3xl text-obsidian dark:text-pearl font-light mb-1">{{ membership.name }}</h3>
															<p class="text-xs tracking-[0.25em] uppercase text-twilight dark:text-lavender-mist font-semibold">{{ membership.tier|upper }}</p>
														</div>
														{% if membership.is_active %}
															<span class="px-3 py-1 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 rounded-lg text-xs font-semibold whitespace-nowrap">Active</span>
														{% endif %}
													</div>

													<div class="mb-6 pb-6 border-b border-obsidian/10 dark:border-pearl/10">
														<div class="flex items-baseline gap-2 mb-2">
															<span class="font-cormorant text-4xl text-rose-gold font-light">${{ membership.price }}</span>
															<span class="text-xs text-twilight dark:text-lavender-mist">/month</span>
														</div>
														<p class="text-sm text-twilight dark:text-lavender-mist leading-relaxed">{{ membership.description }}</p>
													</div>

													<!-- Benefits List -->
													<div class="space-y-2.5">
														{% for benefit in membership.benefits|slice:":4" %}
															<div class="flex items-start gap-2.5">
																<svg class="w-4 h-4 text-rose-gold mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
																	<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
																</svg>
																<span class="text-xs text-obsidian dark:text-pearl">{{ benefit }}</span>
															</div>
														{% endfor %}
													</div>
												</div>

												<!-- Discount Badge -->
												{% if membership.discount_percentage %}
													<div class="mb-6 p-3 bg-rose-gold/10 rounded-lg text-center border border-rose-gold/20">
														<p class="text-xs text-twilight dark:text-lavender-mist mb-1">Member Discount</p>
														<p class="font-cormorant text-2xl text-rose-gold font-light">{{ membership.discount_percentage }}%</p>
													</div>
												{% endif %}

												<div class="flex gap-2">
													<a href="{% url 'backends:add_membership' %}?id={{ membership.id }}"
														class="btn flex-1 px-4 py-2.5 text-xs tracking-[0.2em] uppercase bg-obsidian text-moon-white dark:bg-pearl dark:text-obsidian hover:bg-rose-gold transition-colors text-center rounded-lg font-semibold">Edit</a>
												</div>
											</div>
										{% endif %}
									{% endfor %}
								</div>
							</div>
						{% endfor %}
					</div>

					<!-- Pagination -->
					{% if paginator %}
						<div class="mt-20 flex flex-wrap items-center justify-center gap-3">
							{% if page_obj.has_previous %}
								<a href="?page=1"
									class="btn px-4 py-2 text-xs tracking-[0.2em] uppercase border border-obsidian/20 dark:border-pearl/20 text-obsidian dark:text-pearl hover:text-rose-gold transition-colors rounded-lg">First</a>
								<a href="?page={{ page_obj.previous_page_number }}"
									class="btn px-4 py-2 text-xs tracking-[0.2em] uppercase border border-obsidian/20 dark:border-pearl/20 text-obsidian dark:text-pearl hover:text-rose-gold transition-colors rounded-lg">Previous</a>
							{% endif %}

							{% for num in paginator_list %}
								{% if num == page_obj.number %}
									<span class="px-4 py-2 text-xs tracking-[0.2em] uppercase bg-obsidian text-moon-white dark:bg-pearl dark:text-obsidian rounded-lg font-semibold">{{ num }}</span>
								{% else %}
									<a href="?page={{ num }}"
										class="btn px-4 py-2 text-xs tracking-[0.2em] uppercase border border-obsidian/20 dark:border-pearl/20 text-obsidian dark:text-pearl hover:text-rose-gold transition-colors rounded-lg">{{ num }}</a>
								{% endif %}
							{% endfor %}

							{% if page_obj.has_next %}
								<a href="?page={{ page_obj.next_page_number }}"
									class="btn px-4 py-2 text-xs tracking-[0.2em] uppercase border border-obsidian/20 dark:border-pearl/20 text-obsidian dark:text-pearl hover:text-rose-gold transition-colors rounded-lg">Next</a>
								<a href="?page={{ paginator.num_pages }}"
									class="btn px-4 py-2 text-xs tracking-[0.2em] uppercase border border-obsidian/20 dark:border-pearl/20 text-obsidian dark:text-pearl hover:text-rose-gold transition-colors rounded-lg">Last</a>
							{% endif %}
						</div>
					{% endif %}
				{% else %}
					<div class="rounded-3xl border border-solid border-obsidian/10 dark:border-pearl/10 bg-moon-white/85 dark:bg-black-pearl/70 p-12 shadow-[0_30px_60px_rgba(27,26,23,0.08)] card-glow text-center">
						<p class="text-obsidian dark:text-pearl mb-6">No memberships found</p>
						<a href="{% url 'backends:add_membership' %}"
							class="btn inline-block px-6 py-3 text-xs tracking-[0.25em] uppercase bg-obsidian text-moon-white dark:bg-pearl dark:text-obsidian hover:bg-rose-gold transition-colors">Create First Membership</a>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
</section>
{% endblock %}
